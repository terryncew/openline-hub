<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>OpenLine Hub ¬∑ Portable Proof for AI</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="description" content="Live receipts and researcher kit. Proof moves; data doesn‚Äôt." />
<style>
:root{--bg:#0f1115;--ink:#e9eef7;--muted:#9aa4b2;--tile:#151821;--line:#232838;
--ok:#16a34a;--warn:#f59e0b;--bad:#ef4444}
*{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--ink);
font:15px/1.5 -apple-system,system-ui,Segoe UI,Inter,Helvetica,Arial}
.wrap{max-width:980px;margin:0 auto;padding:20px}
h1,h2,h3{margin:0 0 8px}
.muted{color:var(--muted)} .note{color:var(--muted);font-size:12px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
.tile{padding:14px;border:1px solid var(--line);border-radius:12px;background:var(--tile)}
.row{display:grid;grid-template-columns:90px 1fr;border-top:1px solid #20263a;padding:10px 12px}
.row:first-child{border-top:none;border-top-left-radius:12px;border-top-right-radius:12px}
.card{border:1px solid var(--line);border-radius:12px;background:#10131b}
.chip{display:inline-flex;gap:6px;align-items:center;padding:3px 10px;border-radius:999px;border:1px solid #2a3042;font-size:11px}
.ok{background:#0f1a12;border-color:#173224} .warn{background:#1e180a;border-color:#3d2e0a}
.bad{background:#1e0c0f;border-color:#3a1118} .neutral{background:#0b0d12;border-color:#1c2130}
input,button{font:inherit} input{width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0b0d12;color:var(--ink)}
.btn{padding:10px 14px;border-radius:10px;border:1px solid var(--ink);background:transparent;color:var(--ink);cursor:pointer}
.inline{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
</style>
</head>
<body>
<div class="wrap">
  <h1>OpenLine Hub</h1>
  <p class="muted">Proof moves; data doesn‚Äôt. Triage, not truth.</p>

  <!-- Featured -->
  <h2>Featured receipt</h2>
  <div id="featured" class="tile"></div>

  <!-- Local receipts -->
  <h2 style="margin-top:16px">Local receipts</h2>
  <p class="note">Reads <code>docs/receipts/manifest.json</code>.</p>
  <div id="grid" class="grid" aria-live="polite"></div>

  <!-- Kit -->
  <h2 style="margin-top:16px">Researcher kit</h2>
  <div class="tile">
    <div class="inline" style="margin-bottom:8px">
      <input id="valIn" placeholder="Paste a receipt URL or JSON" />
      <button id="valBtn" class="btn">Validate</button>
      <button id="cpyBtn" class="btn">Copy Template</button>
    </div>
    <pre id="valOut" class="note" style="white-space:pre-wrap;margin:0"></pre>
  </div>

  <p class="note" style="margin-top:18px">OpenLine ¬∑ COLE ¬∑ MIT ¬© Sir Terrynce</p>
</div>

<script>
const FEATURED_URL = './receipt.latest.json'; // change to any https URL if you want
const RX_ROOT = './receipts';                 // docs/receipts/*
const bust = '?v=' + Date.now();

const el=(t,c,txt)=>{const e=document.createElement(t); if(c) e.className=c; if(txt!=null) e.textContent=txt; return e;};
const row=(k,v)=>{const r=el('div','row'); r.appendChild(el('div','',k)); r.appendChild(el('div','',v||'‚Äî')); return r;};
const statusInfo=s=>{
  const x=String(s||'').toLowerCase();
  if(['clean','coherent','ok','green'].includes(x)) return {cls:'ok',text:'CLEAN'};
  if(['amber','warn','check'].includes(x)) return {cls:'warn',text:'CHECK'};
  if(['red','risk','bad'].includes(x)) return {cls:'bad',text:'RISK'};
  return {cls:'neutral',text:'‚Äî'};
};
const precPair=r=>{
  const a=(r?.precision?.train_dtype||'fp16').toLowerCase();
  const b=(r?.precision?.infer_dtype||a).toLowerCase();
  return `${a}/${b}`;
};

function renderTile(rec, srcPath){
  const t=el('div','tile');
  const head=el('div','inline');
  head.style.justifyContent='space-between'; head.style.alignItems='center'; head.style.marginBottom='6px';
  const left=el('div','');
  left.appendChild(el('h3','',`${rec?.model?.family||'demo-llm'} ¬∑ ${rec?.version||'OLR/1.5-P'}`));
  left.appendChild(el('div','muted', rec?.issued_at || ''));
  const s=statusInfo(rec?.attrs?.status || rec?.status);
  const right=el('div','inline'); right.appendChild(el('span',`chip ${s.cls}`,s.text));
  right.appendChild(el('span','chip neutral',precPair(rec)));
  head.appendChild(left); head.appendChild(right);

  const c=el('div','card');
  c.appendChild(row('POINT',rec.point||rec?.claims?.point));
  c.appendChild(row('BECAUSE',rec.because||rec?.claims?.because));
  c.appendChild(row('BUT',rec.but||rec?.claims?.but));
  c.appendChild(row('SO',rec.so||rec?.claims?.so));

  t.appendChild(head); t.appendChild(c);
  t.appendChild(el('div','note','source: '+srcPath));
  return t;
}

async function loadJSON(url){
  const r = await fetch(url,{cache:'no-store'});
  if(!r.ok) throw new Error(`HTTP ${r.status}`);
  const txt = await r.text();
  if(txt.trim().startsWith('<')) throw new Error('URL returned HTML (not JSON)'); // catches Pages 404s
  return {json: JSON.parse(txt), bytes: new TextEncoder().encode(txt).length};
}

(async function(){
  // Featured
  try{
    const {json} = await loadJSON(FEATURED_URL + bust);
    document.getElementById('featured').replaceWith(renderTile(json,'receipt.latest.json'));
  }catch(e){
    const f=document.getElementById('featured'); f.textContent='Failed to load featured: ' + e.message;
  }

  // Local grid
  const grid = document.getElementById('grid');
  try{
    const {json:m} = await loadJSON(`${RX_ROOT}/manifest.json` + bust);
    if(!Array.isArray(m.files)||!m.files.length){ grid.textContent='No local receipts found.'; return; }
    for(const name of m.files){
      try{
        const {json} = await loadJSON(`${RX_ROOT}/${name}` + bust);
        grid.appendChild(renderTile(json, `receipts/${name}`));
      }catch(e){ const t=el('div','tile',''+name+': '+e.message); grid.appendChild(t); }
    }
  }catch(e){ grid.textContent = 'No manifest: ' + e.message; }
})();

// Kit
document.getElementById('cpyBtn').onclick=()=>{
  const j={
    receipt_version:"1.5-P",
    version:"OLR/1.5-P",
    issued_at:new Date().toISOString(),
    attrs:{status:"clean"},
    model:{family:"demo-llm"},
    precision:{train_dtype:"fp16",infer_dtype:"fp16"},
    point:"Run fp16/fp16 for speed on commodity GPUs.",
    because:"Œ∫ and Œîhol remain within green bounds on short sequences.",
    but:"Overflow risk rises on very long contexts or mixed-device runs.",
    so:"Ship fp16 for demos; keep a bf16 path for ‚â•4k tokens."
  };
  navigator.clipboard.writeText(JSON.stringify(j,null,2));
  document.getElementById('valOut').textContent='üìã Template copied';
};

document.getElementById('valBtn').onclick=async()=>{
  const out=document.getElementById('valOut'); out.textContent='‚Ä¶checking';
  const v=(document.getElementById('valIn').value||'').trim();
  let txt='';
  try{
    if(!v) throw new Error('Provide a URL or paste JSON');
    if(v.startsWith('{')) { txt=v; }
    else {
      const r=await fetch(v,{cache:'no-store'});
      if(!r.ok) throw new Error(`HTTP ${r.status}`);
      txt=await r.text();
      if(txt.trim().startsWith('<')) throw new Error('URL returned HTML (not JSON)');
    }
    const obj=JSON.parse(txt);
    const bytes=new TextEncoder().encode(txt).length;
    const errs=[];
    if(!obj.receipt_version) errs.push('missing receipt_version');
    if(!obj.version) errs.push('missing version');
    if(!(obj.attrs && typeof obj.attrs.status==='string')) errs.push('missing attrs.status');
    const status=(obj.attrs?.status||'').toLowerCase();
    const isGreen=['clean','coherent','ok','green'].includes(status);
    if(isGreen && bytes>640) errs.push(`CLEAN exceeds 640B (${bytes})`);
    if(!isGreen && ['amber','warn','check','red','risk','bad'].includes(status) && bytes>800) errs.push(`${status} exceeds 800B (${bytes})`);
    out.textContent = errs.length ? '‚ùå FAIL\n- '+errs.join('\n- ') : `‚úÖ PASS\nbytes=${bytes} status=${status||'n/a'}`;
  }catch(e){ out.textContent='‚ùå '+(e.message||'Parse error'); }
};
</script>
</body>
</html>
